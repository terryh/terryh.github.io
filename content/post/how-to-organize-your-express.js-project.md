+++
title = "How to organize your express.js project"
date = 2013-09-10T18:25:00Z
updated = 2013-09-10T18:48:06Z
tags = ["Express", "Node.js"]
blogimport = true 
[author]
	name = "TerryH"
	uri = "https://www.blogger.com/profile/00198432946574471177"
+++

這是一個，一直就想寫的筆記了<br /><br />在 javascript 裡面，往往有過大的彈性，到最後，龐大的專案，到最後模組之間關係，錯綜複雜<br /><br />在加上團隊成員也有各自的組織風格，後至撰寫風格，加入 coffeescript，livescript 等，就算用 grunt 來組織 build  專案<br /><br />也難掩架構變得複雜的事實<br /><br />這裡要舉的筆記例子，對於初學者，我會建議，可以參考 Madhusudhan Srinivasa 大大的範例，由這一個範例去思考架構方式<br /><br /><a href="https://github.com/madhums/node-express-mongoose-demo">https://github.com/madhums/node-express-mongoose-demo</a><br /><br />我自己的偏好，則是折衷由 express 產生的預設架構，然後用 express.js 作者 <a href="https://github.com/visionmedia">TJ Holowaychuk</a> 在影片中建議的模組方式來將不同功能的程式模組拆開，可以方便以資料夾的結構<br /><br />將不同功能的元件分別使用在不同的專案，方便擴充<br /><br /><iframe src="//player.vimeo.com/video/56166857" width="500" height="313" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe> <p><a href="http://vimeo.com/56166857">Modular web applications with Node.js and Express</a> from <a href="http://vimeo.com/user8021748">tjholowaychuk</a> on <a href="https://vimeo.com">Vimeo</a>.</p><br /><br />程式目錄架構，會比較像這樣，把不同功能的模組分拆<br /><br /><pre><code class="language-bash"><br />terry@terrytekiMacBook-Air ~/Dropbox/notwait/server (master) $ tree -d -p app/*<br />app/home<br />app/middleware<br />app/password<br />app/site<br />app/users<br /></code><br /></pre><br />另外主要的 server 端程式，架構就沒有太多的修改，在以下是我部分 app.js 裡面的組織方式，以供參考<br /><br /><br /><pre><code class="language-javascript"><br />/**<br /> * Module dependencies.<br /> */<br /><br />var express = require('express')<br />  , csrf = express.csrf()<br />  , fs = require('fs')<br />  , mongoStore = require('connect-mongo')(express)<br />  , flash = require('connect-flash')<br />  , helpers = require('view-helpers')<br />  , routes = require('./routes')<br />  , user = require('./routes/user')<br />  , mongoose = require('mongoose')<br />  , http = require('http')<br />  , path = require('path')<br />  , i18n = require('i18n');<br /><br /><br />/**<br /> * setup enviroment<br /> *<br /> */<br />var env = process.env.NODE_ENV || 'development'<br />  , config = require('./config')[env];<br /><br />/**<br /> * i18n<br /> *<br /> */<br />i18n.configure({<br />  locales: ['en', 'zh'],<br />  cookie: 'i18n',<br />  directory: __dirname + '/locales'<br />});<br /><br /><br />/**<br /> * mongoose<br /> *<br /> */<br />mongoose.connect(config.db)<br />var models_path = __dirname + '/models'<br />fs.readdirSync(models_path).forEach(function (file) {<br />  if (~file.indexOf('.js')) require(models_path + '/' + file)<br />})<br /><br /><br />/**<br /> *  以下省略，其他模組的設定，自己的模組可以像是下面引入<br /> */ <br /><br />// development env config<br />app.configure('development', function () {<br />  app.locals.pretty = true<br />})<br /><br />// users signup, twitter, facebook, google, passport must before any routing<br />require('app/users')(app, config);<br /><br />// site, contact form<br />require('app/site')(app, config);<br /><br />// password reset, forgot<br />require('app/password')(app, config);<br /><br />// home, user dashboard<br />require('app/home')(app, config);<br /><br />// ...<br />// ...<br /><br />http.createServer(app).listen(app.get('port'), function(){<br />  console.log('Express server listening on port ' +<br />              app.get('port') + " in " +<br />              env + " mode " +<br />              "talk to " + config.db);<br />});<br /><br />/**<br /> * export self<br /> *<br /> */<br />exports = module.exports = app;<br /></code></pre>

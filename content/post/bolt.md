+++
title = "bolt"
date = 2014-09-16T06:47:00Z
updated = 2014-09-16T18:08:08Z
tags = ["Golang"]
blogimport = true 
[author]
	name = "TerryH"
	uri = "https://www.blogger.com/profile/00198432946574471177"
+++

記錄一下一些好用 golang library<br /><br />blot 是一個純 golang 以簡單為美開發的 key value 資料庫，後來會用他，是因為一開始要存非常簡單的資料<br /><br />想說就用 sqlite 來存就好了，反正欄位很少，資料結構簡單，開發環境是 Mac ，目標環境是 Linux ，部署的流程<br /><br />就用 python 的 fabric 簡化，本地端編譯完 linux/amd64 的程式，複製到遠端 Linux，可是 github.com/mattn/go-sqlite3 有用到<br /><br />CGO ，在 Mac 上面必須要用 gcc for linux 來編譯，編譯完後，到了目標機器上面又有 glibc 版本的問題，覺得這樣很花時間<br /><br />不方便，另外就是 CGO 的編譯速度沒有很帥氣，立馬就決定找一個不依賴 CGO 的 key value store，目前覺得蠻合用了，這個專案的頁面的第一句話<br /><br />就說服我了(我也太沒原則了吧) "Simple is the new beautiful." <br /><br /><a href="https://github.com/boltdb/bolt">https://github.com/boltdb/bolt</a><br /><br />使用簡單，由於我的 server  主要還是用簡單 JSON 格式，所以就先不用 gob 來 Encode 資料<br /><br /><pre><code class="language-markup"><br />// Example for bolt<br />package main<br /><br />import (<br />        "encoding/json"<br />        "fmt"<br /><br />        "github.com/boltdb/bolt"<br />)<br /><br />var (<br />        db         *bolt.DB<br />        dbpath     = "./user.db"<br />        userbucket = []byte("users")<br />)<br /><br />func main() {<br /><br />        db, _ = bolt.Open(dbpath, 0644, nil)<br /><br />        key := []byte("unique_key_here")<br />        var value = struct {<br />                Name  string<br />                Title string<br />        }{"Somebody", "Gopher"}<br /><br />        fmt.Println(key, value)<br /><br />        // in write transaction<br />        err := db.Update(func(tx *bolt.Tx) error {<br />                bucket, err := tx.CreateBucketIfNotExists(userbucket)<br />                if err != nil {<br />                        return err<br />                }<br />                data, err := json.Marshal(value)<br /><br />                fmt.Println("Please remember handle the error", err)<br /><br />                if err == nil {<br />                        bucket.Put(key, data)<br />                }<br /><br />                return nil<br />        })<br /><br />        fmt.Println(err)<br />        // in read<br />        db.View(func(tx *bolt.Tx) error {<br />                bucket := tx.Bucket(userbucket)<br />                if bucket != nil {<br />                        // if have a struct to restore it<br />                        //json.Unmarshal(bucket.Get([]byte(key)), &user)<br />                        fmt.Println(bucket.Get(key))<br />                }<br /><br />                return nil<br />        })<br /><br />}<br /><br /><br /></code></pre>

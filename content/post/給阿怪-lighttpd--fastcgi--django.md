+++
title = "給阿怪 Lighttpd + Fastcgi + Django"
date = 2008-06-17T05:32:00Z
updated = 2008-06-17T20:01:17Z
tags = ["Debian", "Python", "Django"]
blogimport = true 
[author]
	name = "TerryH"
	uri = "https://www.blogger.com/profile/00198432946574471177"
+++

<span style="font-size:180%;">我的環境</span><br /><br />Debian testing <br />Python 2.5.2<br />MySQL 5.0.51a<br />Lighttpd  1.4.19<br />Django Django version 0.97-pre-SVN-7480<br /><br />Django 專案位址，您要對應您自己的位址<br /><br />/home/terry/digez<br /><br /><br /><span style="font-size:180%;">Python 的部份</span><br />要安裝 python-flup<br /><br /><span style="font-size:180%;">Django 的部份</span><br /><br />一般只要把 django 用 fastcgi 的方式跑起來，即可<br /><br />在命令列執行方式，其中 socket 還有 pidfile 可以放在你喜歡的地方，注意權限沒有問題就可以，也可以用 TCP 的方式執行 fastcgi<br />可以在命令列下打 ./manage.py help runfcgi 得到更多的提示<br /><br /><br /><code><br />/home/terry/digez/manage.py runfcgi socket=/home/terry/run/digez.sock pidfile=/home/terry/run/digez.pid<br /></code><br /><br />您可以把執行的方式，寫成 Linux 或是 FreeBSD 下的 init.d 的執行方式，也可以用 supervisord 的方式來監控啟動<br /><br />init.d 的方式可以參考 <a href="http://code.djangoproject.com/wiki/InitdScriptForDebian">http://code.djangoproject.com/wiki/InitdScriptForDebian</a><br /><br /><br /><span style="font-size:180%;">Lighttpd 的部份</span><br />至少必須把 fastcgi 的模組啟動<br />在 Debian 的環境下，用 root的權限，在命令列下打<br /><code><br />lighttpd-enable-mod<br /></code><br /><br />來啟動，下面是我執行的結果<br /><code><br />terry:~# lighttpd-enable-mod <br />Available modules: auth cgi fastcgi proxy rrdtool simple-vhost ssi ssl status userdir <br />Already enabled modules: fastcgi simple-vhost <br /><br />Enable module: <br /></code><br /><br />下面則是在 Lighttpd 下，我設的 virtual host，我所有的主機都是設定 virtual host 的方式<br />下面是整個 virtual host 的設定檔，我的環境下是放在 /etc/lighttpd/conf-enabled/10-simple-vhost.conf<br />有井字號開頭的，整行是註解<br />在這裡面要注意的是 socket file 的權限，如果是 執行 Lighttpd 的 user 是 www-data 的話，socket 檔案的權限就要是 www-data 可以的讀寫<br />設定裡那個叫 /mysite.fcgi 的檔案，是假的，不必真實存在<br /><br /><code><br />## Simple name-based virtual hosting<br />##<br />## Documentation: /usr/share/doc/lighttpd-doc/simple-vhost.txt<br />##                http://www.lighttpd.net/documentation/simple-vhost.html<br /><br />server.modules += ( "mod_simple_vhost" )<br /><br />## The document root of a virtual host isdocument-root =<br />##   simple-vhost.server-root + $HTTP["host"] + simple-vhost.document-root<br />simple-vhost.server-root         = "/var/www"<br />simple-vhost.document-root       = "/blog/"<br />simple-vhost.default-host        = "home.digez.com"<br />$HTTP["host"] =~ "^(home.digez.com|stock.digez.com)$" {<br />        server.document-root = "/home/terry/digez"<br />        <br />        fastcgi.server = (<br />        "/mysite.fcgi" => (<br />                "main" => (<br />                # Use host / port instead of socket for TCP fastcgi<br />                #"host" => "127.0.0.1",<br />                #"port" => 8080,<br />                "socket" => "/home/terry/run/digez.sock",<br />                "check-local" => "disable",<br />                )<br />        ),<br /><br />)<br />        alias.url = (<br />                "/media/" => "/home/terry/django_src/django/contrib/admin/media/",<br />                "/site_media/" => "/home/terry/media/",<br />                )<br /><br />        url.rewrite-once = (<br />                "^(/media.*)$" => "$1",<br />                "^(/site_media.*)$" => "$1",<br />                "^/favicon\.ico$" => "/site_media/images/favicon.ico",<br />                "^(/.*)$" => "/mysite.fcgi$1",<br />        )<br />}<br /><br /><br /><br /><br /></code><br /><br /><br />以上Lighttpd 設定更改過後，該重新啟動的要啟動過後才會生效，有關於 Lighttpd 設定還有多進階的方法，可以幫我們擋攻擊，或是增加效能 ;-)
